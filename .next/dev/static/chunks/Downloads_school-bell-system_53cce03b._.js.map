{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Downloads/school-bell-system/lib/pwa/register-sw.ts"],"sourcesContent":["// Service Worker Registration Module\r\n// Handles registration, updates, and lifecycle events\r\n\r\nexport interface ServiceWorkerConfig {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n  onOffline?: () => void;\r\n  onOnline?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nlet swRegistration: ServiceWorkerRegistration | null = null;\r\n\r\n/**\r\n * Register the service worker\r\n */\r\nexport function registerServiceWorker(config: ServiceWorkerConfig = {}): void {\r\n  // Check if service workers are supported\r\n  if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\r\n    console.warn('[SW] Service workers are not supported in this browser');\r\n    return;\r\n  }\r\n\r\n  // Register on page load\r\n  window.addEventListener('load', () => {\r\n    const swUrl = '/sw.js';\r\n\r\n    navigator.serviceWorker\r\n      .register(swUrl)\r\n      .then((registration) => {\r\n        swRegistration = registration;\r\n        console.log('[SW] Service worker registered successfully');\r\n\r\n        // Check for updates\r\n        registration.addEventListener('updatefound', () => {\r\n          const newWorker = registration.installing;\r\n          if (!newWorker) return;\r\n\r\n          newWorker.addEventListener('statechange', () => {\r\n            if (newWorker.state === 'installed') {\r\n              if (navigator.serviceWorker.controller) {\r\n                // New update available\r\n                console.log('[SW] New content available, please refresh');\r\n                config.onUpdate?.(registration);\r\n              } else {\r\n                // Content cached for offline use\r\n                console.log('[SW] Content cached for offline use');\r\n                config.onSuccess?.(registration);\r\n              }\r\n            }\r\n          });\r\n        });\r\n\r\n        // Check for updates periodically (every hour)\r\n        setInterval(() => {\r\n          registration.update();\r\n        }, 60 * 60 * 1000);\r\n      })\r\n      .catch((error) => {\r\n        console.error('[SW] Service worker registration failed:', error);\r\n        config.onError?.(error);\r\n      });\r\n\r\n    // Listen for online/offline events\r\n    window.addEventListener('online', () => {\r\n      console.log('[SW] Back online');\r\n      config.onOnline?.();\r\n    });\r\n\r\n    window.addEventListener('offline', () => {\r\n      console.log('[SW] Gone offline');\r\n      config.onOffline?.();\r\n    });\r\n\r\n    // Listen for messages from service worker\r\n    navigator.serviceWorker.addEventListener('message', (event) => {\r\n      console.log('[SW] Message from service worker:', event.data);\r\n      \r\n      if (event.data.type === 'PLAY_BELL') {\r\n        // Handle bell play request from service worker\r\n        window.dispatchEvent(new CustomEvent('sw-play-bell', {\r\n          detail: event.data.payload\r\n        }));\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Unregister the service worker\r\n */\r\nexport async function unregisterServiceWorker(): Promise<boolean> {\r\n  if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const registration = await navigator.serviceWorker.ready;\r\n    const success = await registration.unregister();\r\n    \r\n    if (success) {\r\n      console.log('[SW] Service worker unregistered successfully');\r\n      swRegistration = null;\r\n    }\r\n    \r\n    return success;\r\n  } catch (error) {\r\n    console.error('[SW] Service worker unregistration failed:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get the current service worker registration\r\n */\r\nexport function getServiceWorkerRegistration(): ServiceWorkerRegistration | null {\r\n  return swRegistration;\r\n}\r\n\r\n/**\r\n * Check if service worker is registered and active\r\n */\r\nexport async function isServiceWorkerActive(): Promise<boolean> {\r\n  if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const registration = await navigator.serviceWorker.ready;\r\n    return registration.active !== null;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Force update the service worker\r\n */\r\nexport async function updateServiceWorker(): Promise<void> {\r\n  if (!swRegistration) {\r\n    console.warn('[SW] No service worker registration found');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    await swRegistration.update();\r\n    console.log('[SW] Service worker update check initiated');\r\n  } catch (error) {\r\n    console.error('[SW] Service worker update failed:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Skip waiting and activate new service worker immediately\r\n */\r\nexport function skipWaitingAndActivate(): void {\r\n  if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\r\n    return;\r\n  }\r\n\r\n  navigator.serviceWorker.controller?.postMessage({ type: 'SKIP_WAITING' });\r\n  window.location.reload();\r\n}\r\n\r\n/**\r\n * Get cache storage information\r\n */\r\nexport async function getCacheInfo(): Promise<{\r\n  caches: string[];\r\n  totalSize: number;\r\n}> {\r\n  if (typeof window === 'undefined' || !('caches' in window)) {\r\n    return { caches: [], totalSize: 0 };\r\n  }\r\n\r\n  try {\r\n    const cacheNames = await caches.keys();\r\n    let totalSize = 0;\r\n\r\n    for (const cacheName of cacheNames) {\r\n      const cache = await caches.open(cacheName);\r\n      const requests = await cache.keys();\r\n      \r\n      for (const request of requests) {\r\n        const response = await cache.match(request);\r\n        if (response) {\r\n          const blob = await response.blob();\r\n          totalSize += blob.size;\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      caches: cacheNames,\r\n      totalSize,\r\n    };\r\n  } catch (error) {\r\n    console.error('[SW] Failed to get cache info:', error);\r\n    return { caches: [], totalSize: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all caches\r\n */\r\nexport async function clearAllCaches(): Promise<void> {\r\n  if (typeof window === 'undefined' || !('caches' in window)) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const cacheNames = await caches.keys();\r\n    await Promise.all(cacheNames.map((cacheName) => caches.delete(cacheName)));\r\n    console.log('[SW] All caches cleared');\r\n  } catch (error) {\r\n    console.error('[SW] Failed to clear caches:', error);\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Downloads/school-bell-system/components/pwa-init.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect } from \"react\"\r\nimport { registerServiceWorker } from \"@/lib/pwa/register-sw\"\r\nimport { toast } from \"sonner\"\r\n\r\n/**\r\n * PWA Initialization Component\r\n * Registers service worker and handles PWA events\r\n */\r\nexport function PWAInit() {\r\n  useEffect(() => {\r\n    // Register service worker\r\n    registerServiceWorker({\r\n      onSuccess: () => {\r\n        console.log(\"âœ… App is ready for offline use\");\r\n      },\r\n      onUpdate: () => {\r\n        toast.info(\"New version available!\", {\r\n          description: \"Refresh to update the app\",\r\n          action: {\r\n            label: \"Refresh\",\r\n            onClick: () => window.location.reload(),\r\n          },\r\n          duration: 10000,\r\n        });\r\n      },\r\n      onOffline: () => {\r\n        toast.warning(\"You are offline\", {\r\n          description: \"Some features may be limited\",\r\n        });\r\n      },\r\n      onOnline: () => {\r\n        toast.success(\"Back online!\", {\r\n          description: \"All features are available\",\r\n        });\r\n      },\r\n      onError: (error) => {\r\n        console.error(\"Service worker registration failed:\", error);\r\n      },\r\n    });\r\n\r\n    // Listen for bell play events from service worker\r\n    const handleBellPlay = (event: Event) => {\r\n      const customEvent = event as CustomEvent;\r\n      console.log(\"ðŸ”” Bell play requested by service worker:\", customEvent.detail);\r\n      // The actual bell playing will be handled by the bell system\r\n    };\r\n\r\n    window.addEventListener(\"sw-play-bell\", handleBellPlay);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"sw-play-bell\", handleBellPlay);\r\n    };\r\n  }, []);\r\n\r\n  return null; // This component doesn't render anything\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAUO,SAAS;;IACd,IAAA,mNAAS;6BAAC;YACR,0BAA0B;YAC1B,IAAA,iMAAqB,EAAC;gBACpB,SAAS;yCAAE;wBACT,QAAQ,GAAG,CAAC;oBACd;;gBACA,QAAQ;yCAAE;wBACR,6LAAK,CAAC,IAAI,CAAC,0BAA0B;4BACnC,aAAa;4BACb,QAAQ;gCACN,OAAO;gCACP,OAAO;yDAAE,IAAM,OAAO,QAAQ,CAAC,MAAM;;4BACvC;4BACA,UAAU;wBACZ;oBACF;;gBACA,SAAS;yCAAE;wBACT,6LAAK,CAAC,OAAO,CAAC,mBAAmB;4BAC/B,aAAa;wBACf;oBACF;;gBACA,QAAQ;yCAAE;wBACR,6LAAK,CAAC,OAAO,CAAC,gBAAgB;4BAC5B,aAAa;wBACf;oBACF;;gBACA,OAAO;yCAAE,CAAC;wBACR,QAAQ,KAAK,CAAC,uCAAuC;oBACvD;;YACF;YAEA,kDAAkD;YAClD,MAAM;oDAAiB,CAAC;oBACtB,MAAM,cAAc;oBACpB,QAAQ,GAAG,CAAC,6CAA6C,YAAY,MAAM;gBAC3E,6DAA6D;gBAC/D;;YAEA,OAAO,gBAAgB,CAAC,gBAAgB;YAExC;qCAAO;oBACL,OAAO,mBAAmB,CAAC,gBAAgB;gBAC7C;;QACF;4BAAG,EAAE;IAEL,OAAO,MAAM,yCAAyC;AACxD;GA/CgB;KAAA"}}]
}