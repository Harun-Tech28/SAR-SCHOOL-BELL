{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Downloads/school-bell-system/lib/pwa/register-sw.ts"],"sourcesContent":["// Service Worker Registration Module\r\n// Handles registration, updates, and lifecycle events\r\n\r\nexport interface ServiceWorkerConfig {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n  onOffline?: () => void;\r\n  onOnline?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nlet swRegistration: ServiceWorkerRegistration | null = null;\r\n\r\n/**\r\n * Register the service worker\r\n */\r\nexport function registerServiceWorker(config: ServiceWorkerConfig = {}): void {\r\n  // Check if service workers are supported\r\n  if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\r\n    console.warn('[SW] Service workers are not supported in this browser');\r\n    return;\r\n  }\r\n\r\n  // Register on page load\r\n  window.addEventListener('load', () => {\r\n    const swUrl = '/sw.js';\r\n\r\n    navigator.serviceWorker\r\n      .register(swUrl)\r\n      .then((registration) => {\r\n        swRegistration = registration;\r\n        console.log('[SW] Service worker registered successfully');\r\n\r\n        // Check for updates\r\n        registration.addEventListener('updatefound', () => {\r\n          const newWorker = registration.installing;\r\n          if (!newWorker) return;\r\n\r\n          newWorker.addEventListener('statechange', () => {\r\n            if (newWorker.state === 'installed') {\r\n              if (navigator.serviceWorker.controller) {\r\n                // New update available\r\n                console.log('[SW] New content available, please refresh');\r\n                config.onUpdate?.(registration);\r\n              } else {\r\n                // Content cached for offline use\r\n                console.log('[SW] Content cached for offline use');\r\n                config.onSuccess?.(registration);\r\n              }\r\n            }\r\n          });\r\n        });\r\n\r\n        // Check for updates periodically (every hour)\r\n        setInterval(() => {\r\n          registration.update();\r\n        }, 60 * 60 * 1000);\r\n      })\r\n      .catch((error) => {\r\n        console.error('[SW] Service worker registration failed:', error);\r\n        config.onError?.(error);\r\n      });\r\n\r\n    // Listen for online/offline events\r\n    window.addEventListener('online', () => {\r\n      console.log('[SW] Back online');\r\n      config.onOnline?.();\r\n    });\r\n\r\n    window.addEventListener('offline', () => {\r\n      console.log('[SW] Gone offline');\r\n      config.onOffline?.();\r\n    });\r\n\r\n    // Listen for messages from service worker\r\n    navigator.serviceWorker.addEventListener('message', (event) => {\r\n      console.log('[SW] Message from service worker:', event.data);\r\n      \r\n      if (event.data.type === 'PLAY_BELL') {\r\n        // Handle bell play request from service worker\r\n        window.dispatchEvent(new CustomEvent('sw-play-bell', {\r\n          detail: event.data.payload\r\n        }));\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Unregister the service worker\r\n */\r\nexport async function unregisterServiceWorker(): Promise<boolean> {\r\n  if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const registration = await navigator.serviceWorker.ready;\r\n    const success = await registration.unregister();\r\n    \r\n    if (success) {\r\n      console.log('[SW] Service worker unregistered successfully');\r\n      swRegistration = null;\r\n    }\r\n    \r\n    return success;\r\n  } catch (error) {\r\n    console.error('[SW] Service worker unregistration failed:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get the current service worker registration\r\n */\r\nexport function getServiceWorkerRegistration(): ServiceWorkerRegistration | null {\r\n  return swRegistration;\r\n}\r\n\r\n/**\r\n * Check if service worker is registered and active\r\n */\r\nexport async function isServiceWorkerActive(): Promise<boolean> {\r\n  if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const registration = await navigator.serviceWorker.ready;\r\n    return registration.active !== null;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Force update the service worker\r\n */\r\nexport async function updateServiceWorker(): Promise<void> {\r\n  if (!swRegistration) {\r\n    console.warn('[SW] No service worker registration found');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    await swRegistration.update();\r\n    console.log('[SW] Service worker update check initiated');\r\n  } catch (error) {\r\n    console.error('[SW] Service worker update failed:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Skip waiting and activate new service worker immediately\r\n */\r\nexport function skipWaitingAndActivate(): void {\r\n  if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\r\n    return;\r\n  }\r\n\r\n  navigator.serviceWorker.controller?.postMessage({ type: 'SKIP_WAITING' });\r\n  window.location.reload();\r\n}\r\n\r\n/**\r\n * Get cache storage information\r\n */\r\nexport async function getCacheInfo(): Promise<{\r\n  caches: string[];\r\n  totalSize: number;\r\n}> {\r\n  if (typeof window === 'undefined' || !('caches' in window)) {\r\n    return { caches: [], totalSize: 0 };\r\n  }\r\n\r\n  try {\r\n    const cacheNames = await caches.keys();\r\n    let totalSize = 0;\r\n\r\n    for (const cacheName of cacheNames) {\r\n      const cache = await caches.open(cacheName);\r\n      const requests = await cache.keys();\r\n      \r\n      for (const request of requests) {\r\n        const response = await cache.match(request);\r\n        if (response) {\r\n          const blob = await response.blob();\r\n          totalSize += blob.size;\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      caches: cacheNames,\r\n      totalSize,\r\n    };\r\n  } catch (error) {\r\n    console.error('[SW] Failed to get cache info:', error);\r\n    return { caches: [], totalSize: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all caches\r\n */\r\nexport async function clearAllCaches(): Promise<void> {\r\n  if (typeof window === 'undefined' || !('caches' in window)) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const cacheNames = await caches.keys();\r\n    await Promise.all(cacheNames.map((cacheName) => caches.delete(cacheName)));\r\n    console.log('[SW] All caches cleared');\r\n  } catch (error) {\r\n    console.error('[SW] Failed to clear caches:', error);\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,qCAAqC;AACrC,sDAAsD;;;;;;;;;;;;;;;;;;;AAUtD,IAAI,iBAAmD;AAKhD,SAAS,sBAAsB,SAA8B,CAAC,CAAC;IACpE,yCAAyC;IACzC,IAAI,kDAAkB,eAAe,CAAC,CAAC,mBAAmB,SAAS,GAAG;QACpE,QAAQ,IAAI,CAAC;QACb;IACF;;;AAiEF;AAKO,eAAe;IACpB,IAAI,kDAAkB,eAAe,CAAC,CAAC,mBAAmB,SAAS,GAAG;QACpE,OAAO;IACT;;;AAgBF;AAKO,SAAS;IACd,OAAO;AACT;AAKO,eAAe;IACpB,IAAI,kDAAkB,eAAe,CAAC,CAAC,mBAAmB,SAAS,GAAG;QACpE,OAAO;IACT;;;AAQF;AAKO,eAAe;IACpB,IAAI,CAAC,gBAAgB;QACnB,QAAQ,IAAI,CAAC;QACb;IACF;IAEA,IAAI;QACF,MAAM,eAAe,MAAM;QAC3B,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;IACtD;AACF;AAKO,SAAS;IACd,IAAI,kDAAkB,eAAe,CAAC,CAAC,mBAAmB,SAAS,GAAG;QACpE;IACF;;;AAIF;AAKO,eAAe;IAIpB,IAAI,kDAAkB,eAAe,CAAC,CAAC,YAAY,MAAM,GAAG;QAC1D,OAAO;YAAE,QAAQ,EAAE;YAAE,WAAW;QAAE;IACpC;;;AA2BF;AAKO,eAAe;IACpB,IAAI,kDAAkB,eAAe,CAAC,CAAC,YAAY,MAAM,GAAG;QAC1D;IACF;;;AASF"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Downloads/school-bell-system/lib/pwa/storage-manager.ts"],"sourcesContent":["// Storage Manager for PWA\r\n// Handles IndexedDB and LocalStorage operations\r\n\r\nexport interface StorageQuota {\r\n  usage: number;\r\n  quota: number;\r\n  percentage: number;\r\n}\r\n\r\nconst DB_NAME = \"SARBellSystemDB\";\r\nconst DB_VERSION = 1;\r\n\r\n// IndexedDB store names\r\nexport const STORES = {\r\n  TIMETABLE: \"timetable\",\r\n  STUDENTS: \"students\",\r\n  ANNOUNCEMENTS: \"announcements\",\r\n  SETTINGS: \"settings\",\r\n} as const;\r\n\r\n/**\r\n * Storage Manager Class\r\n * Provides unified interface for IndexedDB and LocalStorage\r\n */\r\nexport class StorageManager {\r\n  private db: IDBDatabase | null = null;\r\n\r\n  /**\r\n   * Initialize IndexedDB\r\n   */\r\n  async init(): Promise<void> {\r\n    if (typeof window === \"undefined\" || !(\"indexedDB\" in window)) {\r\n      console.warn(\"[Storage] IndexedDB not available\");\r\n      return;\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n      request.onerror = () => {\r\n        console.error(\"[Storage] Failed to open database:\", request.error);\r\n        reject(request.error);\r\n      };\r\n\r\n      request.onsuccess = () => {\r\n        this.db = request.result;\r\n        console.log(\"[Storage] Database opened successfully\");\r\n        resolve();\r\n      };\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = (event.target as IDBOpenDBRequest).result;\r\n\r\n        // Create object stores if they don't exist\r\n        if (!db.objectStoreNames.contains(STORES.TIMETABLE)) {\r\n          db.createObjectStore(STORES.TIMETABLE, { keyPath: \"id\" });\r\n          console.log(\"[Storage] Created timetable store\");\r\n        }\r\n\r\n        if (!db.objectStoreNames.contains(STORES.STUDENTS)) {\r\n          db.createObjectStore(STORES.STUDENTS, { keyPath: \"id\" });\r\n          console.log(\"[Storage] Created students store\");\r\n        }\r\n\r\n        if (!db.objectStoreNames.contains(STORES.ANNOUNCEMENTS)) {\r\n          db.createObjectStore(STORES.ANNOUNCEMENTS, { keyPath: \"id\" });\r\n          console.log(\"[Storage] Created announcements store\");\r\n        }\r\n\r\n        if (!db.objectStoreNames.contains(STORES.SETTINGS)) {\r\n          db.createObjectStore(STORES.SETTINGS);\r\n          console.log(\"[Storage] Created settings store\");\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save data to IndexedDB\r\n   */\r\n  async saveToIndexedDB<T>(\r\n    store: keyof typeof STORES,\r\n    key: string,\r\n    data: T\r\n  ): Promise<void> {\r\n    if (!this.db) {\r\n      await this.init();\r\n    }\r\n\r\n    if (!this.db) {\r\n      throw new Error(\"Database not initialized\");\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORES[store]], \"readwrite\");\r\n      const objectStore = transaction.objectStore(STORES[store]);\r\n      const request = objectStore.put({ id: key, ...data });\r\n\r\n      request.onsuccess = () => {\r\n        console.log(`[Storage] Saved to ${store}:`, key);\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error(`[Storage] Failed to save to ${store}:`, request.error);\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get data from IndexedDB\r\n   */\r\n  async getFromIndexedDB<T>(\r\n    store: keyof typeof STORES,\r\n    key: string\r\n  ): Promise<T | null> {\r\n    if (!this.db) {\r\n      await this.init();\r\n    }\r\n\r\n    if (!this.db) {\r\n      return null;\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORES[store]], \"readonly\");\r\n      const objectStore = transaction.objectStore(STORES[store]);\r\n      const request = objectStore.get(key);\r\n\r\n      request.onsuccess = () => {\r\n        const result = request.result;\r\n        if (result) {\r\n          const { id, ...data } = result;\r\n          resolve(data as T);\r\n        } else {\r\n          resolve(null);\r\n        }\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error(`[Storage] Failed to get from ${store}:`, request.error);\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get all data from a store\r\n   */\r\n  async getAllFromIndexedDB<T>(store: keyof typeof STORES): Promise<T[]> {\r\n    if (!this.db) {\r\n      await this.init();\r\n    }\r\n\r\n    if (!this.db) {\r\n      return [];\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORES[store]], \"readonly\");\r\n      const objectStore = transaction.objectStore(STORES[store]);\r\n      const request = objectStore.getAll();\r\n\r\n      request.onsuccess = () => {\r\n        const results = request.result || [];\r\n        resolve(results as T[]);\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error(\r\n          `[Storage] Failed to get all from ${store}:`,\r\n          request.error\r\n        );\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Delete data from IndexedDB\r\n   */\r\n  async deleteFromIndexedDB(\r\n    store: keyof typeof STORES,\r\n    key: string\r\n  ): Promise<void> {\r\n    if (!this.db) {\r\n      await this.init();\r\n    }\r\n\r\n    if (!this.db) {\r\n      throw new Error(\"Database not initialized\");\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORES[store]], \"readwrite\");\r\n      const objectStore = transaction.objectStore(STORES[store]);\r\n      const request = objectStore.delete(key);\r\n\r\n      request.onsuccess = () => {\r\n        console.log(`[Storage] Deleted from ${store}:`, key);\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error(\r\n          `[Storage] Failed to delete from ${store}:`,\r\n          request.error\r\n        );\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear all data from a store\r\n   */\r\n  async clearStore(store: keyof typeof STORES): Promise<void> {\r\n    if (!this.db) {\r\n      await this.init();\r\n    }\r\n\r\n    if (!this.db) {\r\n      throw new Error(\"Database not initialized\");\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORES[store]], \"readwrite\");\r\n      const objectStore = transaction.objectStore(STORES[store]);\r\n      const request = objectStore.clear();\r\n\r\n      request.onsuccess = () => {\r\n        console.log(`[Storage] Cleared store: ${store}`);\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        console.error(`[Storage] Failed to clear ${store}:`, request.error);\r\n        reject(request.error);\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save to LocalStorage\r\n   */\r\n  saveToLocalStorage(key: string, value: any): void {\r\n    if (typeof window === \"undefined\" || !(\"localStorage\" in window)) {\r\n      console.warn(\"[Storage] LocalStorage not available\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const serialized = JSON.stringify(value);\r\n      localStorage.setItem(key, serialized);\r\n      console.log(`[Storage] Saved to localStorage: ${key}`);\r\n    } catch (error) {\r\n      console.error(\"[Storage] Failed to save to localStorage:\", error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get from LocalStorage\r\n   */\r\n  getFromLocalStorage<T>(key: string): T | null {\r\n    if (typeof window === \"undefined\" || !(\"localStorage\" in window)) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const serialized = localStorage.getItem(key);\r\n      if (serialized === null) {\r\n        return null;\r\n      }\r\n      return JSON.parse(serialized) as T;\r\n    } catch (error) {\r\n      console.error(\"[Storage] Failed to get from localStorage:\", error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove from LocalStorage\r\n   */\r\n  removeFromLocalStorage(key: string): void {\r\n    if (typeof window === \"undefined\" || !(\"localStorage\" in window)) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      localStorage.removeItem(key);\r\n      console.log(`[Storage] Removed from localStorage: ${key}`);\r\n    } catch (error) {\r\n      console.error(\"[Storage] Failed to remove from localStorage:\", error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all LocalStorage\r\n   */\r\n  clearLocalStorage(): void {\r\n    if (typeof window === \"undefined\" || !(\"localStorage\" in window)) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      localStorage.clear();\r\n      console.log(\"[Storage] Cleared localStorage\");\r\n    } catch (error) {\r\n      console.error(\"[Storage] Failed to clear localStorage:\", error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get storage quota information\r\n   */\r\n  async getStorageQuota(): Promise<StorageQuota> {\r\n    if (\r\n      typeof window === \"undefined\" ||\r\n      !(\"navigator\" in window) ||\r\n      !(\"storage\" in navigator) ||\r\n      !(\"estimate\" in navigator.storage)\r\n    ) {\r\n      return { usage: 0, quota: 0, percentage: 0 };\r\n    }\r\n\r\n    try {\r\n      const estimate = await navigator.storage.estimate();\r\n      const usage = estimate.usage || 0;\r\n      const quota = estimate.quota || 0;\r\n      const percentage = quota > 0 ? (usage / quota) * 100 : 0;\r\n\r\n      return {\r\n        usage,\r\n        quota,\r\n        percentage: Math.round(percentage * 100) / 100,\r\n      };\r\n    } catch (error) {\r\n      console.error(\"[Storage] Failed to get storage quota:\", error);\r\n      return { usage: 0, quota: 0, percentage: 0 };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all storage (IndexedDB + LocalStorage)\r\n   */\r\n  async clearAllStorage(): Promise<void> {\r\n    // Clear IndexedDB\r\n    const stores = Object.keys(STORES) as Array<keyof typeof STORES>;\r\n    for (const store of stores) {\r\n      try {\r\n        await this.clearStore(store);\r\n      } catch (error) {\r\n        console.error(`[Storage] Failed to clear ${store}:`, error);\r\n      }\r\n    }\r\n\r\n    // Clear LocalStorage\r\n    this.clearLocalStorage();\r\n\r\n    console.log(\"[Storage] All storage cleared\");\r\n  }\r\n\r\n  /**\r\n   * Export all data (for backup)\r\n   */\r\n  async exportData(): Promise<Record<string, any>> {\r\n    const data: Record<string, any> = {};\r\n\r\n    // Export IndexedDB data\r\n    const stores = Object.keys(STORES) as Array<keyof typeof STORES>;\r\n    for (const store of stores) {\r\n      try {\r\n        data[store] = await this.getAllFromIndexedDB(store);\r\n      } catch (error) {\r\n        console.error(`[Storage] Failed to export ${store}:`, error);\r\n        data[store] = [];\r\n      }\r\n    }\r\n\r\n    // Export LocalStorage data\r\n    if (typeof window !== \"undefined\" && \"localStorage\" in window) {\r\n      data.localStorage = {};\r\n      for (let i = 0; i < localStorage.length; i++) {\r\n        const key = localStorage.key(i);\r\n        if (key) {\r\n          data.localStorage[key] = this.getFromLocalStorage(key);\r\n        }\r\n      }\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Import data (for restore)\r\n   */\r\n  async importData(data: Record<string, any>): Promise<void> {\r\n    // Import IndexedDB data\r\n    const stores = Object.keys(STORES) as Array<keyof typeof STORES>;\r\n    for (const store of stores) {\r\n      if (data[store] && Array.isArray(data[store])) {\r\n        for (const item of data[store]) {\r\n          try {\r\n            await this.saveToIndexedDB(store, item.id, item);\r\n          } catch (error) {\r\n            console.error(`[Storage] Failed to import to ${store}:`, error);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Import LocalStorage data\r\n    if (data.localStorage && typeof data.localStorage === \"object\") {\r\n      for (const [key, value] of Object.entries(data.localStorage)) {\r\n        this.saveToLocalStorage(key, value);\r\n      }\r\n    }\r\n\r\n    console.log(\"[Storage] Data imported successfully\");\r\n  }\r\n\r\n  /**\r\n   * Close database connection\r\n   */\r\n  close(): void {\r\n    if (this.db) {\r\n      this.db.close();\r\n      this.db = null;\r\n      console.log(\"[Storage] Database closed\");\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const storageManager = new StorageManager();\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 402, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Downloads/school-bell-system/components/pwa-init.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect } from \"react\"\r\nimport { registerServiceWorker } from \"@/lib/pwa/register-sw\"\r\nimport { storageManager } from \"@/lib/pwa/storage-manager\"\r\nimport { toast } from \"sonner\"\r\n\r\n/**\r\n * PWA Initialization Component\r\n * Registers service worker and handles PWA events\r\n */\r\nexport function PWAInit() {\r\n  useEffect(() => {\r\n    // Initialize storage manager\r\n    storageManager.init().catch((error) => {\r\n      console.error(\"Failed to initialize storage:\", error);\r\n    });\r\n\r\n    // Register service worker\r\n    registerServiceWorker({\r\n      onSuccess: () => {\r\n        console.log(\"âœ… App is ready for offline use\");\r\n      },\r\n      onUpdate: () => {\r\n        toast.info(\"New version available!\", {\r\n          description: \"Refresh to update the app\",\r\n          action: {\r\n            label: \"Refresh\",\r\n            onClick: () => window.location.reload(),\r\n          },\r\n          duration: 10000,\r\n        });\r\n      },\r\n      onOffline: () => {\r\n        toast.warning(\"You are offline\", {\r\n          description: \"Some features may be limited\",\r\n        });\r\n      },\r\n      onOnline: () => {\r\n        toast.success(\"Back online!\", {\r\n          description: \"All features are available\",\r\n        });\r\n      },\r\n      onError: (error) => {\r\n        console.error(\"Service worker registration failed:\", error);\r\n      },\r\n    });\r\n\r\n    // Listen for bell play events from service worker\r\n    const handleBellPlay = (event: Event) => {\r\n      const customEvent = event as CustomEvent;\r\n      console.log(\"ðŸ”” Bell play requested by service worker:\", customEvent.detail);\r\n      // The actual bell playing will be handled by the bell system\r\n    };\r\n\r\n    window.addEventListener(\"sw-play-bell\", handleBellPlay);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"sw-play-bell\", handleBellPlay);\r\n    };\r\n  }, []);\r\n\r\n  return null; // This component doesn't render anything\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AALA;;;;;AAWO,SAAS;IACd,IAAA,2PAAS,EAAC;QACR,6BAA6B;QAC7B,2LAAc,CAAC,IAAI,GAAG,KAAK,CAAC,CAAC;YAC3B,QAAQ,KAAK,CAAC,iCAAiC;QACjD;QAEA,0BAA0B;QAC1B,IAAA,8LAAqB,EAAC;YACpB,WAAW;gBACT,QAAQ,GAAG,CAAC;YACd;YACA,UAAU;gBACR,0LAAK,CAAC,IAAI,CAAC,0BAA0B;oBACnC,aAAa;oBACb,QAAQ;wBACN,OAAO;wBACP,SAAS,IAAM,OAAO,QAAQ,CAAC,MAAM;oBACvC;oBACA,UAAU;gBACZ;YACF;YACA,WAAW;gBACT,0LAAK,CAAC,OAAO,CAAC,mBAAmB;oBAC/B,aAAa;gBACf;YACF;YACA,UAAU;gBACR,0LAAK,CAAC,OAAO,CAAC,gBAAgB;oBAC5B,aAAa;gBACf;YACF;YACA,SAAS,CAAC;gBACR,QAAQ,KAAK,CAAC,uCAAuC;YACvD;QACF;QAEA,kDAAkD;QAClD,MAAM,iBAAiB,CAAC;YACtB,MAAM,cAAc;YACpB,QAAQ,GAAG,CAAC,6CAA6C,YAAY,MAAM;QAC3E,6DAA6D;QAC/D;QAEA,OAAO,gBAAgB,CAAC,gBAAgB;QAExC,OAAO;YACL,OAAO,mBAAmB,CAAC,gBAAgB;QAC7C;IACF,GAAG,EAAE;IAEL,OAAO,MAAM,yCAAyC;AACxD"}},
    {"offset": {"line": 467, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Downloads/school-bell-system/hooks/use-online-status.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState } from \"react\"\r\n\r\nexport interface OnlineStatus {\r\n  isOnline: boolean\r\n  isOffline: boolean\r\n  effectiveType?: string\r\n  downlink?: number\r\n  rtt?: number\r\n}\r\n\r\n/**\r\n * Hook to detect online/offline status\r\n * Also provides network quality information if available\r\n */\r\nexport function useOnlineStatus(): OnlineStatus {\r\n  const [isOnline, setIsOnline] = useState(true)\r\n  const [networkInfo, setNetworkInfo] = useState<{\r\n    effectiveType?: string\r\n    downlink?: number\r\n    rtt?: number\r\n  }>({})\r\n\r\n  useEffect(() => {\r\n    // Check if we're in the browser\r\n    if (typeof window === \"undefined\") {\r\n      return\r\n    }\r\n\r\n    // Set initial online status\r\n    setIsOnline(navigator.onLine)\r\n\r\n    // Update network info if available\r\n    const updateNetworkInfo = () => {\r\n      if (\"connection\" in navigator) {\r\n        const connection = (navigator as any).connection\r\n        setNetworkInfo({\r\n          effectiveType: connection?.effectiveType,\r\n          downlink: connection?.downlink,\r\n          rtt: connection?.rtt,\r\n        })\r\n      }\r\n    }\r\n\r\n    updateNetworkInfo()\r\n\r\n    // Listen for online/offline events\r\n    const handleOnline = () => {\r\n      console.log(\"[Network] Back online\")\r\n      setIsOnline(true)\r\n      updateNetworkInfo()\r\n    }\r\n\r\n    const handleOffline = () => {\r\n      console.log(\"[Network] Gone offline\")\r\n      setIsOnline(false)\r\n    }\r\n\r\n    // Listen for network quality changes\r\n    const handleConnectionChange = () => {\r\n      updateNetworkInfo()\r\n    }\r\n\r\n    window.addEventListener(\"online\", handleOnline)\r\n    window.addEventListener(\"offline\", handleOffline)\r\n\r\n    // Listen for connection changes if available\r\n    if (\"connection\" in navigator) {\r\n      const connection = (navigator as any).connection\r\n      connection?.addEventListener(\"change\", handleConnectionChange)\r\n    }\r\n\r\n    // Cleanup\r\n    return () => {\r\n      window.removeEventListener(\"online\", handleOnline)\r\n      window.removeEventListener(\"offline\", handleOffline)\r\n\r\n      if (\"connection\" in navigator) {\r\n        const connection = (navigator as any).connection\r\n        connection?.removeEventListener(\"change\", handleConnectionChange)\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  return {\r\n    isOnline,\r\n    isOffline: !isOnline,\r\n    ...networkInfo,\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAgBO,SAAS;IACd,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,0PAAQ,EAAC;IACzC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,0PAAQ,EAI3C,CAAC;IAEJ,IAAA,2PAAS,EAAC;QACR,gCAAgC;QAChC,wCAAmC;YACjC;QACF;;;QAKA,mCAAmC;QACnC,MAAM;QAaN,mCAAmC;QACnC,MAAM;QAMN,MAAM;QAKN,qCAAqC;QACrC,MAAM;IAuBR,GAAG,EAAE;IAEL,OAAO;QACL;QACA,WAAW,CAAC;QACZ,GAAG,WAAW;IAChB;AACF"}},
    {"offset": {"line": 502, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Downloads/school-bell-system/components/offline-indicator.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useOnlineStatus } from \"@/hooks/use-online-status\"\r\nimport { WifiOff, Wifi } from \"lucide-react\"\r\nimport { useEffect, useState } from \"react\"\r\n\r\nexport interface OfflineIndicatorProps {\r\n  position?: \"top\" | \"bottom\"\r\n  showWhenOnline?: boolean\r\n  customMessage?: string\r\n}\r\n\r\n/**\r\n * Offline Indicator Component\r\n * Shows a banner when the user is offline\r\n */\r\nexport function OfflineIndicator({\r\n  position = \"top\",\r\n  showWhenOnline = false,\r\n  customMessage,\r\n}: OfflineIndicatorProps) {\r\n  const { isOnline, isOffline } = useOnlineStatus()\r\n  const [showOnlineMessage, setShowOnlineMessage] = useState(false)\r\n\r\n  useEffect(() => {\r\n    if (isOnline && showWhenOnline) {\r\n      setShowOnlineMessage(true)\r\n      // Hide the online message after 3 seconds\r\n      const timer = setTimeout(() => {\r\n        setShowOnlineMessage(false)\r\n      }, 3000)\r\n      return () => clearTimeout(timer)\r\n    }\r\n  }, [isOnline, showWhenOnline])\r\n\r\n  // Don't show anything if online and not showing online message\r\n  if (isOnline && !showOnlineMessage) {\r\n    return null\r\n  }\r\n\r\n  const positionClasses =\r\n    position === \"top\"\r\n      ? \"top-0 left-0 right-0\"\r\n      : \"bottom-0 left-0 right-0\"\r\n\r\n  return (\r\n    <div\r\n      className={`fixed ${positionClasses} z-50 animate-in slide-in-from-top duration-300`}\r\n    >\r\n      {isOffline && (\r\n        <div className=\"bg-yellow-500 text-yellow-950 px-4 py-2 text-center text-sm font-medium flex items-center justify-center gap-2\">\r\n          <WifiOff className=\"h-4 w-4\" />\r\n          <span>\r\n            {customMessage || \"You are offline. Some features may be limited.\"}\r\n          </span>\r\n        </div>\r\n      )}\r\n\r\n      {isOnline && showOnlineMessage && (\r\n        <div className=\"bg-green-500 text-green-950 px-4 py-2 text-center text-sm font-medium flex items-center justify-center gap-2 animate-in slide-in-from-top duration-300\">\r\n          <Wifi className=\"h-4 w-4\" />\r\n          <span>Back online! All features are available.</span>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AAJA;;;;;AAgBO,SAAS,iBAAiB,EAC/B,WAAW,KAAK,EAChB,iBAAiB,KAAK,EACtB,aAAa,EACS;IACtB,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,IAAA,4LAAe;IAC/C,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,0PAAQ,EAAC;IAE3D,IAAA,2PAAS,EAAC;QACR,IAAI,YAAY,gBAAgB;YAC9B,qBAAqB;YACrB,0CAA0C;YAC1C,MAAM,QAAQ,WAAW;gBACvB,qBAAqB;YACvB,GAAG;YACH,OAAO,IAAM,aAAa;QAC5B;IACF,GAAG;QAAC;QAAU;KAAe;IAE7B,+DAA+D;IAC/D,IAAI,YAAY,CAAC,mBAAmB;QAClC,OAAO;IACT;IAEA,MAAM,kBACJ,aAAa,QACT,yBACA;IAEN,qBACE,uRAAC;QACC,WAAW,CAAC,MAAM,EAAE,gBAAgB,+CAA+C,CAAC;;YAEnF,2BACC,uRAAC;gBAAI,WAAU;;kCACb,uRAAC,gQAAO;wBAAC,WAAU;;;;;;kCACnB,uRAAC;kCACE,iBAAiB;;;;;;;;;;;;YAKvB,YAAY,mCACX,uRAAC;gBAAI,WAAU;;kCACb,uRAAC,mPAAI;wBAAC,WAAU;;;;;;kCAChB,uRAAC;kCAAK;;;;;;;;;;;;;;;;;;AAKhB"}}]
}